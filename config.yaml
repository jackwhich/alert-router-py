server:
  host: 0.0.0.0
  port: 8080

logging:
  log_dir: "logs"
  log_file: "alert-router.log"
  level: "INFO"
  max_bytes: 10485760
  backup_count: 5

# 全局代理开关（控制是否使用代理）
# true: 启用代理（默认）
# false: 禁用代理（所有渠道都不使用代理）
proxy_enabled: true

proxy:
  http: "socks5://10.8.16.64:13080"
  https: "socks5://10.8.16.64:13080"

# Prometheus 告警图片渲染
prometheus_image:
  enabled: true
  # Prometheus API 地址，例如: http://prometheus:9090，如果为空则从 generatorURL 解析
  prometheus_url: ""
  lookback_minutes: 15
  step: "30s"
  timeout_seconds: 8
  max_series: 8

# Grafana 告警图片渲染
grafana_image:
  enabled: true
  # Grafana 地址，例如: http://grafana:3000（用于 Grafana 渲染服务，可选）
  grafana_url: ""
  # Prometheus API 地址，例如: http://prometheus:9090（如果 Grafana 使用 Prometheus 数据源，用于提取查询表达式）
  prometheus_url: ""
  lookback_minutes: 15
  step: "30s"
  timeout_seconds: 8
  max_series: 8

jenkins_dedup:
  enabled: true
  ttl_seconds: 900
  clear_on_resolved: true

defaults:
  title_prefix: "[ALERT]"
  dashboard_fallback: ""
  runbook_fallback: ""

# 渠道配置说明：命名规范 = 来源_渠道_用途
# - 来源：prometheus、grafana（谁发的告警）
# - 渠道：telegram、slack（发到哪里）
# - 用途：default、critical、warning、jenkins 等

channels:
  # Prometheus 告警渠道
  prometheus_telegram_default:
    type: telegram
    enabled: true
    image_enabled: true
    bot_token: "8502571186:xxxxx"
    chat_id: "-5134533386"
    template: "prometheus_telegram.html.j2"

  prometheus_telegram_critical:
    type: telegram
    enabled: false
    image_enabled: false
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567890"
    template: "prometheus_telegram.html.j2"

  prometheus_slack:
    type: slack
    enabled: true
    webhook_url: "https://hooks.slack.com/services/T000/B000/XXX"
    template: "prometheus_slack.json.j2"

  # Grafana 告警渠道
  grafana_telegram_default:
    type: telegram
    enabled: true
    bot_token: "8502571186:xxxxx"
    chat_id: "-5134533386"
    template: "grafana_telegram.html.j2"

  grafana_telegram_critical:
    type: telegram
    enabled: false
    bot_token: "8502571186:xxxxx"
    chat_id: "-5134533386"
    template: "grafana_telegram.html.j2"

  grafana_slack:
    type: slack
    enabled: false
    webhook_url: "https://hooks.slack.com/services/T000/B000/YYY"
    template: "grafana_slack.json.j2"

  # Jenkins 告警渠道
  prometheus_telegram_jenkins:
    # Jenkins 渠道关闭趋势图
    # Jenkins 告警只发送 firing，不发送 resolved
    type: telegram
    enabled: true
    image_enabled: false
    bot_token: "8502571186:xxxxx"
    chat_id: "-5134533386"
    template: "prometheus_telegram_jenkins.html.j2"
    send_resolved: false

# 路由：所有告警发默认渠道；severity=critical/灾难 时额外发灾难渠道（共 2 个渠道）
routing:
  # Jenkins 告警（Prometheus 来源）走专用模板/群组
  - match:
      _source: "prometheus"
      _receiver: "Prometheus"
      jenkins_job: ".*"
    send_to: ["prometheus_telegram_default"]

  # 告警来源 = Prometheus（支持 critical 或 灾难）
  - match:
      _source: "prometheus"
      alertname: "^(?!Jenkins|jenkins).*"
      severity: "critical|灾难"
    send_to: ["prometheus_telegram_critical"]

  - match:
      _source: "prometheus"
      _receiver: "prod_ebpay_jenkins_alarm"
      alertname: ".*Jenkins.*|.*jenkins.*"
    send_to: ["prometheus_telegram_jenkins"]

  # 告警来源 = Grafana（支持 critical 或 灾难）
  - match:
      _source: "grafana"
      severity: "critical|灾难"
    send_to: ["grafana_telegram_critical"]

  - match:
      _source: "grafana"
    send_to: ["grafana_telegram_default"]

