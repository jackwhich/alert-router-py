server:
  host: 0.0.0.0
  port: 8080

# 日志配置
logging:
  # 日志目录（相对于项目根目录）
  log_dir: "logs"
  # 日志文件名
  log_file: "alert-router.log"
  # 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  # 单个日志文件最大大小（字节，默认 10MB）
  max_bytes: 10485760
  # 保留的备份文件数量
  backup_count: 5

# 全局代理配置（所有渠道默认使用，可被渠道级别配置覆盖）
# 
# 使用 SOCKS5 代理（支持所有协议，更通用）
# 格式：socks5://proxy:port 或 socks5://user:pass@proxy:port
# 优点：支持所有协议（HTTP/HTTPS/TCP/UDP等），更灵活
# 注意：需要安装 requests[socks] 依赖（已在 requirements.txt 中）
#
# 配置示例：
proxy:
  http: "socks5://10.8.16.64:13080"   # SOCKS5 代理
  https: "socks5://10.8.16.64:13080"
# 或者使用字符串格式（会自动应用到 http 和 https）：
# proxy: "socks5://10.8.16.64:13080"    # SOCKS5 代理
# 或者使用带认证的 SOCKS5 代理：
# proxy: "socks5://user:pass@10.8.16.64:13080"

# 全局代理开关（控制是否使用代理）
# true: 启用代理（默认）
# false: 禁用代理（所有渠道都不使用代理）
proxy_enabled: true

defaults:
  title_prefix: "[ALERT]"
  dashboard_fallback: ""
  runbook_fallback: ""

# 渠道配置说明：命名规范 = 来源_渠道_用途
# - 来源：prometheus、grafana（谁发的告警）
# - 渠道：telegram、slack（发到哪里）
# - 用途：default、critical、warning、jenkins 等

channels:
  # ---------- 来源 = Prometheus ----------
  prometheus_telegram_default:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567890"
    template: "prometheus_telegram.html.j2"

  prometheus_telegram_critical:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567890"
    template: "prometheus_telegram.html.j2"

  prometheus_telegram_warning:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567891"
    template: "prometheus_telegram.html.j2"

  prometheus_slack:
    type: slack
    enabled: true
    webhook_url: "https://hooks.slack.com/services/T000/B000/XXX"
    template: "prometheus_slack.json.j2"

  # ---------- 来源 = Grafana ----------
  grafana_telegram_default:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567890"  # Grafana 默认群组（可与 Prometheus 默认同群或单独建群）
    template: "grafana_telegram.html.j2"

  grafana_telegram_critical:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567892"
    template: "grafana_telegram.html.j2"

  grafana_telegram_warning:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567893"
    template: "grafana_telegram.html.j2"

  grafana_slack:
    type: slack
    enabled: true
    webhook_url: "https://hooks.slack.com/services/T000/B000/YYY"
    template: "grafana_slack.json.j2"

  # ---------- 其他（Jenkins 来自 Prometheus/Alertmanager） ----------
  prometheus_telegram_jenkins:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567894"  # Jenkins 告警群组
    template: "prometheus_telegram_jenkins.html.j2"
    send_resolved: false  # Jenkins 告警只发送 firing，不发送 resolved（对应 Alertmanager 的 send_resolved: false）

# 路由：按告警来源(_source) 决定发到哪些「发送渠道」
routing:
  # 告警来源 = Prometheus
  - match:
      _source: "prometheus"
      severity: "critical"
    send_to: ["prometheus_telegram_critical", "prometheus_slack"]
  - match:
      _source: "prometheus"
      severity: "warning"
    send_to: ["prometheus_telegram_warning", "prometheus_slack"]
  - match:
      _source: "prometheus"
    send_to: ["prometheus_telegram_default", "prometheus_slack"]

  # 告警来源 = Grafana
  - match:
      _source: "grafana"
      severity: "critical"
    send_to: ["grafana_telegram_critical", "grafana_slack"]
  - match:
      _source: "grafana"
      severity: "warning"
    send_to: ["grafana_telegram_warning", "grafana_slack"]
  - match:
      _source: "grafana"
    send_to: ["grafana_telegram_default", "grafana_slack"]

  # 其他（如 Jenkins）
  - match:
      jenkins_job: ".*"
    send_to: ["prometheus_telegram_jenkins"]

  # 兜底：未匹配的告警发到 Prometheus 默认 Telegram
  - default: true
    send_to: ["prometheus_telegram_default"]
