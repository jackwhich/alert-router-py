server:
  host: 0.0.0.0
  port: 8080

# 日志配置
logging:
  # 日志目录（相对于项目根目录）
  log_dir: "logs"
  # 日志文件名
  log_file: "alert-router.log"
  # 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  # 单个日志文件最大大小（字节，默认 10MB）
  max_bytes: 10485760
  # 保留的备份文件数量
  backup_count: 5

# 全局代理配置（所有渠道默认使用，可被渠道级别配置覆盖）
# 
# 使用 SOCKS5 代理（支持所有协议，更通用）
# 格式：socks5://proxy:port 或 socks5://user:pass@proxy:port
# 优点：支持所有协议（HTTP/HTTPS/TCP/UDP等），更灵活
# 注意：需要安装 requests[socks] 依赖（已在 requirements.txt 中）
#
# 配置示例：
proxy:
  http: "socks5://10.8.16.64:13080"   # SOCKS5 代理
  https: "socks5://10.8.16.64:13080"
# 或者使用字符串格式（会自动应用到 http 和 https）：
# proxy: "socks5://10.8.16.64:13080"    # SOCKS5 代理
# 或者使用带认证的 SOCKS5 代理：
# proxy: "socks5://user:pass@10.8.16.64:13080"

# 全局代理开关（控制是否使用代理）
# true: 启用代理（默认）
# false: 禁用代理（所有渠道都不使用代理）
proxy_enabled: true

defaults:
  title_prefix: "[ALERT]"
  dashboard_fallback: ""
  runbook_fallback: ""

channels:
  # 默认 Telegram 渠道（所有告警都会发送到这里）
  tg_default:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567890"  # 默认告警群组
    template: "telegram.html.j2"  # 使用 HTML 格式，表情符号显示更稳定

  # Prometheus 告警群组配置
  tg_prometheus_critical:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567890"  # Prometheus 关键告警群组
    template: "telegram.html.j2"  # 使用 HTML 格式，表情符号显示更稳定
    # 代理配置（可选，不配置则使用全局代理）
    # proxy:
    #   http: "socks5://user:pass@proxy:port"   # 带认证的 SOCKS5 代理
    #   https: "socks5://user:pass@proxy:port"
    # 或者使用字符串格式：
    # proxy: "socks5://proxy:port"  # 不带认证的 SOCKS5 代理
    # proxy: "socks5://user:pass@proxy:port"  # 带认证的 SOCKS5 代理
    # 代理开关（可选，不配置则使用全局开关）
    # proxy_enabled: true   # 启用代理
    # proxy_enabled: false  # 禁用代理（此渠道不走代理）

  tg_prometheus_warning:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567891"  # Prometheus 警告告警群组
    template: "telegram.html.j2"  # 使用 HTML 格式，表情符号显示更稳定

  slack_prometheus:
    type: slack
    enabled: true
    webhook_url: "https://hooks.slack.com/services/T000/B000/XXX"
    template: "slack.json.j2"

  # Grafana 告警群组配置（使用 Grafana 专用模板，消息中会标明来源）
  tg_grafana_critical:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567892"  # Grafana 关键告警群组
    template: "telegram_grafana.html.j2"  # Grafana 专用模板，区分于 Prometheus
    # 示例：使用带认证的 SOCKS5 代理
    # proxy: "socks5://username:password@10.8.16.64:13080"

  tg_grafana_warning:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567893"  # Grafana 警告告警群组
    template: "telegram_grafana.html.j2"  # Grafana 专用模板

  slack_grafana:
    type: slack
    enabled: true
    webhook_url: "https://hooks.slack.com/services/T000/B000/YYY"
    template: "slack_grafana.json.j2"  # Grafana 专用模板，用户名和来源区分
    # 示例：此渠道不走代理
    # proxy_enabled: false

  # Jenkins 告警群组配置（使用 Jenkins 专用模板）
  tg_jenkins:
    type: telegram
    enabled: true
    bot_token: "123456:AAxxxx"
    chat_id: "-1001234567894"  # Jenkins 告警群组
    template: "telegram_jenkins.html.j2"  # 使用 Jenkins 专用 HTML 模板
    send_resolved: false  # Jenkins 告警只发送 firing，不发送 resolved（对应 Alertmanager 的 send_resolved: false）

routing:
  # Prometheus 告警路由规则
  # Prometheus 关键告警：发送到 Prometheus 专用群组
  - match:
      _source: "prometheus"
      severity: "critical"
    send_to: ["tg_prometheus_critical", "slack_prometheus"]

  # Prometheus 警告告警
  - match:
      _source: "prometheus"
      severity: "warning"
    send_to: ["tg_prometheus_warning", "slack_prometheus"]

  # Prometheus 默认告警
  - match:
      _source: "prometheus"
    send_to: ["tg_default", "slack_prometheus"]

  # Grafana 告警路由规则
  # Grafana 关键告警：发送到 Grafana 专用群组
  - match:
      _source: "grafana"
      severity: "critical"
    send_to: ["tg_grafana_critical", "slack_grafana"]

  # Grafana 警告告警
  - match:
      _source: "grafana"
      severity: "warning"
    send_to: ["tg_grafana_warning", "slack_grafana"]

  # Grafana 默认告警
  - match:
      _source: "grafana"
    send_to: ["tg_default", "slack_grafana"]

  # Jenkins 告警路由规则（包含 jenkins_job label 的告警）
  - match:
      jenkins_job: ".*"  # 匹配所有包含 jenkins_job 的告警
    send_to: ["tg_jenkins"]

  # 默认路由：所有告警都会发送到默认 Telegram 渠道
  # 这个规则应该放在最后，作为兜底规则
  # 注意：默认渠道会与其他匹配的规则渠道叠加发送
  - default: true
    send_to: ["tg_default"]
